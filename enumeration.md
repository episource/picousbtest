### PicoUSB enumeration

#### Using a Pico W as Host and a Pico Debug Probe as Device

<kbd>
<img width="675" alt="pico-usb" src="https://github.com/shreeve/pico-usb/assets/142875/7daaf85d-302d-46e8-9360-e97e20c2a100">
</kbd>

#### Example console output (February 28, 2024)

```
==[ USB host example]==

USB host reset

 EP0_OUT│ 0x00 │ Device 0 (Reset)
 ECR    │      │ 11010000 00000000 00000001 10000000 │ 0xd0000180 │
 INT    │      │ 00000000 00001111 11111111 11111011 │ 0x000ffffb │

=> New ISR #1, device
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │   16 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00000101 │ 0x00000005 │
│INTS   │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│DAR    │      │ 00000000 00000000 00000000 00000000 │ 0x00000000 │
│SSR    │      │ 00000000 00000000 00000010 00000101 │ 0x00000205 │
│SCR    │      │ 00000000 00000000 10001110 00000000 │ 0x00008e00 │
│ECR    │      │ 11010000 00000000 00000001 10000000 │ 0xd0000180 │
│BCR    │      │ 00000000 00000000 00000000 00000000 │ 0x00000000 │
└───────┴──────┴─────────────────────────────────────┴────────────┘

=> Start task #2: TASK_CONNECT
Device connected (full speed)
Enumeration started
Starting GET_MAXSIZE
Get device descriptor
 EP0_IN │ 0x80 │ Device 0 (Start)
 SETUP  │ 0000 │ 80 06 00 01 00 00 08 00                          │ ........
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Buff   │      │ Buffer Handler                      │            │
│DAR    │      │ 00000000 00000000 00000000 00000000 │ 0x00000000 │
│SSR    │      │ 00000000 00000000 00000010 00000101 │ 0x00000205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 10010000 00000000 00000001 10000000 │ 0x90000180 │
│BCR    │      │ 00000000 00000000 01100100 00001000 │ 0x00006408 │
└───────┴──────┴─────────────────────────────────────┴────────────┘
=>
=> New ISR #3, buffer, last
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │  205 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00011100 │ 0x0000001c │
│INTS   │      │ 00000000 00000000 00000000 00011000 │ 0x00000018 │
│DAR    │      │ 00000000 00000000 00000000 00000000 │ 0x00000000 │
│SSR    │      │ 01010000 00000100 00000010 00000101 │ 0x50040205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 10010000 00000000 00000001 10000000 │ 0x90000180 │
│BCR    │      │ 00000000 00000000 11100000 00001000 │ 0x0000e008 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│BUF/1  │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│IN/1   │ 0000 │ 12 01 00 02 00 00 00 08                          │ ........
├───────┼──────┼─────────────────────────────────────┼────────────┤
│XFER   │    8 │ Device 0                            │ Task #4    │
│Data   │ 0000 │ 12 01 00 02 00 00 00 08                          │ ........
└───────┴──────┴─────────────────────────────────────┴────────────┘
 Finish task #2: TASK_CONNECT

=> Start task #4: TASK_CALLBACK
Calling transfer_zlp

=> New ISR #5, buffer, last
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │  367 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00011100 │ 0x0000001c │
│INTS   │      │ 00000000 00000000 00000000 00011000 │ 0x00000018 │
│DAR    │      │ 00000000 00000000 00000000 00000000 │ 0x00000000 │
│SSR    │      │ 01010000 00000100 00000010 00000101 │ 0x50040205 │
│SCR    │      │ 00000000 00000000 10001110 00000100 │ 0x00008e04 │
│ECR    │      │ 10010000 00000000 00000001 10000000 │ 0x90000180 │
│BCR    │      │ 00000000 00000000 01100000 00000000 │ 0x00006000 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│BUF/1  │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│ZLP    │ OUT  │ Device 0                            │ Task #6    │
└───────┴──────┴─────────────────────────────────────┴────────────┘
=> Finish task #4: TASK_CALLBACK

=> Start task #6: TASK_CALLBACK
Calling enumerate
Starting SET_ADDRESS
 EP0_OUT│ 0x00 │ Device 1 (Reset)
Set device address to 1
 EP0_OUT│ 0x00 │ Device 0 (Start)
 SETUP  │ 0000 │ 00 05 01 00 00 00 00 00                          │ ........

=> New ISR #7, buffer, last
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │  532 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00011100 │ 0x0000001c │
│INTS   │      │ 00000000 00000000 00000000 00011000 │ 0x00000018 │
│DAR    │      │ 00000000 00000000 00000000 00000000 │ 0x00000000 │
│SSR    │      │ 01010000 00000100 00000010 00000101 │ 0x50040205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 10010000 00000000 00000001 10000000 │ 0x90000180 │
│BCR    │      │ 00000000 00000000 11100000 00000000 │ 0x0000e000 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│BUF/1  │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│ZLP    │ IN   │ Device 0                            │ Task #8    │
└───────┴──────┴─────────────────────────────────────┴────────────┘
=> Finish task #6: TASK_CALLBACK

=> Start task #8: TASK_CALLBACK
Calling enumerate
Starting GET_DEVICE
Get device descriptor
 EP0_IN │ 0x80 │ Device 1 (Start)
 SETUP  │ 0000 │ 80 06 00 01 00 00 12 00                          │ ........
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Buff   │      │ Buffer Handler                      │            │
│DAR    │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│SSR    │      │ 01010000 00000000 00000010 00000101 │ 0x50000205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 11010000 00000000 00000001 10000000 │ 0xd0000180 │
│BCR    │      │ 00000100 00001000 00100100 00001000 │ 0x04082408 │
└───────┴──────┴─────────────────────────────────────┴────────────┘
=> Fi
=> New ISR #9, buffer
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │  768 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00010100 │ 0x00000014 │
│INTS   │      │ 00000000 00000000 00000000 00010000 │ 0x00000010 │
│DAR    │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│SSR    │      │ 01010000 00000000 00000010 00000101 │ 0x50000205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 11010000 00000000 00000001 10000000 │ 0xd0000180 │
│BCR    │      │ 10000000 00001000 10100000 00001000 │ 0x8008a008 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│BUF/2  │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│IN/1   │ 0000 │ 12 01 00 02 00 00 00 08                          │ ........
│IN/2   │ 0000 │ 03 04 18 cd 00 04 01 02                          │ ........
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Buff   │      │ Buffer Handler                      │            │
│DAR    │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│SSR    │      │ 01010000 00000000 00000010 00000101 │ 0x50000205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 10010000 00000000 00000001 10000000 │ 0x90000180 │
│BCR    │      │ 00000000 00000000 01100100 00000010 │ 0x00006402 │
└───────┴──────┴─────────────────────────────────────┴────────────┘
└───────┴──────┴─────────────────────────────────────┴────────────┘

=> New ISR #10, buffer, last
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │  973 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00011100 │ 0x0000001c │
│INTS   │      │ 00000000 00000000 00000000 00011000 │ 0x00000018 │
│DAR    │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│SSR    │      │ 01010000 00000100 00000010 00000101 │ 0x50040205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 10010000 00000000 00000001 10000000 │ 0x90000180 │
│BCR    │      │ 00000000 00000000 11100000 00000010 │ 0x0000e002 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│BUF/1  │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│IN/1   │ 0000 │ 03 01                                            │ ..
├───────┼──────┼─────────────────────────────────────┼────────────┤
│XFER   │   18 │ Device 1                            │ Task #11   │
│Data   │ 0000 │ 12 01 00 02 00 00 00 08 03 04 18 cd 00 04 01 02  │ ................
│Data   │ 0010 │ 03 01                                            │ ..
└───────┴──────┴─────────────────────────────────────┴────────────┘
nish task #8: TASK_CALLBACK

=> Start task #11: TASK_CALLBACK
Calling transfer_zlp

=> New ISR #12, buffer, last
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │ 1142 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00011100 │ 0x0000001c │
│INTS   │      │ 00000000 00000000 00000000 00011000 │ 0x00000018 │
│DAR    │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│SSR    │      │ 01010000 00000100 00000010 00000101 │ 0x50040205 │
│SCR    │      │ 00000000 00000000 10001110 00000100 │ 0x00008e04 │
│ECR    │      │ 10010000 00000000 00000001 10000000 │ 0x90000180 │
│BCR    │      │ 00000000 00000000 01100000 00000000 │ 0x00006000 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│BUF/1  │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│ZLP    │ OUT  │ Device 1                            │ Task #13   │
└───────┴──────┴─────────────────────────────────────┴────────────┘
=> Finish task #11: TASK_CALLBACK

=> Start task #13: TASK_CALLBACK
Calling enumerate

Connected device:
  USB version:  2.0
  Device class: 0
    Subclass:   0
    Protocol:   0
  Packet size:  8
  Vendor ID:    0x0403
  Product ID:   0xcd18
  Revision:     4.0
  Manufacturer: [#1]
  Product:      [#2]
  Serial:       [#3]

Starting GET_CONFIG
Get configuration descriptor
 EP0_IN │ 0x80 │ Device 1 (Start)
 SETUP  │ 0000 │ 80 06 00 02 00 00 09 00                          │ ........
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Buff   │      │ Buffer Handler                      │            │
│DAR    │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│SSR    │      │ 01010000 00000000 00000010 00000101 │ 0x50000205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 11010000 00000000 00000001 10000000 │ 0xd0000180 │
│BCR    │      │ 01000100 00000001 00100100 00001000 │ 0x44012408 │
└───────┴──────┴─────────────────────────────────────┴────────────┘
=>
=> New ISR #14, buffer, last
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │ 1400 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00011100 │ 0x0000001c │
│INTS   │      │ 00000000 00000000 00000000 00011000 │ 0x00000018 │
│DAR    │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│SSR    │      │ 01010000 00000100 00000010 00000101 │ 0x50040205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 11010000 00000000 00000001 10000000 │ 0xd0000180 │
│BCR    │      │ 11000000 00000001 10100000 00001000 │ 0xc001a008 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│BUF/2  │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│IN/1   │ 0000 │ 09 02 20 00 01 01 00 c0                          │ .. .....
├───────┼──────┼─────────────────────────────────────┼────────────┤
│XFER   │    8 │ Device 1                            │ Task #15   │
│Data   │ 0000 │ 09 02 20 00 01 01 00 c0                          │ .. .....
└───────┴──────┴─────────────────────────────────────┴────────────┘
 Finish task #13: TASK_CALLBACK

=> Start task #15: TASK_CALLBACK
Calling transfer_zlp

=> New ISR #16, buffer, last
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │ 1562 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00011100 │ 0x0000001c │
│INTS   │      │ 00000000 00000000 00000000 00011000 │ 0x00000018 │
│DAR    │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│SSR    │      │ 01010000 00000100 00000010 00000101 │ 0x50040205 │
│SCR    │      │ 00000000 00000000 10001110 00000100 │ 0x00008e04 │
│ECR    │      │ 10010000 00000000 00000001 10000000 │ 0x90000180 │
│BCR    │      │ 00000000 00000000 01100000 00000000 │ 0x00006000 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│BUF/1  │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│ZLP    │ OUT  │ Device 1                            │ Task #17   │
└───────┴──────┴─────────────────────────────────────┴────────────┘
=> Finish task #15: TASK_CALLBACK

=> Start task #17: TASK_CALLBACK
Calling enumerate

Configuration descriptor:
  Total length: 32
  Interfaces:   1
  Config Value: 1
  Config Name:  [#0]
  Attributes:   Self-powered
  Max power:    0mA

Starting SET_CONFIG
Set configuration to 1
 EP0_OUT│ 0x00 │ Device 1 (Start)
 SETUP  │ 0000 │ 00 09 01 00 00 00 00 00                          │ ........

=> New ISR #18, buffer, last
┌───────┬──────┬─────────────────────────────────────┬────────────┐
│Frame  │ 1738 │ Interrupt Handler                   │            │
│INTR   │      │ 00000000 00000000 00000000 00011100 │ 0x0000001c │
│INTS   │      │ 00000000 00000000 00000000 00011000 │ 0x00000018 │
│DAR    │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
│SSR    │      │ 01010000 00000100 00000010 00000101 │ 0x50040205 │
│SCR    │      │ 00000000 00000000 10001110 00001010 │ 0x00008e0a │
│ECR    │      │ 10010000 00000000 00000001 10000000 │ 0x90000180 │
│BCR    │      │ 00000000 00000000 11100000 00000000 │ 0x0000e000 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│BUF/1  │      │ 00000000 00000000 00000000 00000001 │ 0x00000001 │
├───────┼──────┼─────────────────────────────────────┼────────────┤
│ZLP    │ IN   │ Device 1                            │ Task #19   │
└───────┴──────┴─────────────────────────────────────┴────────────┘
=> Finish task #17: TASK_CALLBACK

=> Start task #19: TASK_CALLBACK
Calling enumerate
Enumeration completed
=> Finish task #19: TASK_CALLBACK
```
